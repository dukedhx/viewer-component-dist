!function(){"use strict";function t(e){let i="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var o=0;o<5;o++)i+=n.charAt(Math.floor(Math.random()*n.length));return e&&e(i)?t(e):i}const e=t(),i="https://developer.api.autodesk.com/modelderivative/v2/viewers/style.min.css?v=v",n="https://developer.api.autodesk.com/modelderivative/v2/viewers/viewer3D.min.js?v=v",o={keepCurrentModels:!0},r="7",s={Defaults:{InitOptions:{},ViewerOptions:{},LoadOptions:{}},InitOptions:{},ViewerOptions:{},LoadOptions:{},getViewer:function(t){t||(t=Object.keys(s.Viewers)[0]);return s.Viewers[t]?Promise.resolve(s.Viewers[t]):new Promise(i=>{const n=function(o){t&&t!=o.detail.name||(window.removeEventListener(e,n),i(o.detail.viewer))};window.addEventListener(e,n)})},start:function(t,e){t?s.ViewerLoaders[t].start():Object.entries(s.ViewerLoaders).filter(t=>!t[1].starting&&!t[1].loaded).forEach(t=>s.start(t[0]))},terminate:function(t){return Promise.all(t?[s.ViewerLoaders[t]]:Object.entries(s.ViewerLoaders).map(t=>new Promise(e=>{t[1].terminate(),e()})))},Promises:{},Viewers:{},state:{loaded:!1},ViewerLoaders:{}};function a(t){if(t&&"string"==typeof t)try{return JSON.parse(t)}catch(t){console.error(t)}return{}}function d(t,e,i){return isNaN(t)?t:(t||i)+(isNaN(i)?"":e)}function l(t,e){return new Promise((i,n)=>{const o=document.createElement("link");o.type="text/css",o.rel="stylesheet",o.onload=()=>i(o),o.onError=()=>n(o),o.href=t,(e||document.head).appendChild(o)})}function c(t,e){const i=document.createElement("style");return i.textContent=t,(e||document.head).appendChild(i),i}function u(t,e){return s.Promises[t]||(s.Promises[t]="function"==typeof e?new Promise(t=>e(t)):e)}function h(e,i){const n=function(t,e){return e.reduce((e,i)=>{const n="object"==typeof i?Object.keys(i)[0]:i,o="object"==typeof i?i[n](t.getAttribute(n)):t.getAttribute(i);return Object.assign(e,{[n]:o})},{})}(e,["url","urn","name","view-name","view","type","guid"]);return n.name=n.name||t(),s.LoadOptions[n.name]=Object.assign(n,i,a((e.querySelector("options")||{}).textContent))}function m(t){return t&&"[object Function]"==={}.toString.call(t)}class p{constructor(t,e,i){this.validate=(n,o,r)=>(m(t)?t(n):t)&&(r||i||(t=>t))(n)||(m(o=o||e)?o(n):function(t){if(t){if(!m(window.AutodeskForge.CallBackHandlers))throw t;window.AutodeskForge.CallBackHandlers(t)}}(o))}}var w={isBase64:new p(t=>{try{return atob(t),!0}catch(t){}return!1},t=>btoa(validators.isTrimmedString(t))),isTrimmedString:new p(t=>"string"==typeof t,null,t=>t.trim()),isNotSet:new p(t=>!t),isFullURN:new p(t=>t=validators.isTrimmedString(t),"Not a string",t=>"urn:"+validators.isBase64.validate("0"==t.indexOf("urn:")?t.substring(4):t)),isFunction:new p(m),isObject:new p(t=>"object"==typeof t),isUrl:new p((function(t){const e=document.createElement("a");return e.href=t,e.host&&e.host!=window.location.host}),"Not a valid URL"),isArray:new p(t=>t instanceof Array)};class g{constructor({name:t,delayLoad:e,models:i,env:n,container:o,useGUI:r,initOptions:a,viewerOptions:d,version:l}){this.delayLoad=e,this.version=l,this.name=w.isTrimmedString.validate(t,"Not properly named!"),this.models=w.isArray.validate(i,"No model load option provided!"),this.container=w.isObject.validate(o,"No valid container provided!"),this.useGUI=r,s.InitOptions[t]=Object.assign({env:i.length&&i[0].url?"Local":"AutodeskProduction"},a),s.ViewerOptions[t]=d,s.ViewerLoaders[t]=this}init(t){u("loadDependency").then(()=>Promise.all((t||[]).map(t=>loadScript(t))).then(()=>this.start()))}start(){this.delayLoad?this.delayLoad=!1:s.state.loaded&&this.loadViewer()}terminate(){this.viewer.finish(),this.loaded=this.starting=!1}loadViewer(){return this.starting=!0,new Promise(t=>Autodesk.Viewing.Initializer(Object.assign(s.Defaults.InitOptions,s.InitOptions[this.name]),()=>{this.viewer=s.Viewers[this.name]=this.initViewer(),function(t,e,i){window.dispatchEvent(new CustomEvent(t,Object.assign({detail:e},i)))}(e,{viewer:this.viewer,name:this.name}),this.models.forEach(t=>this.loadModel(t.name)),t(this.loaded=!0)}))}loadModel(t){const e=Object.assign({},s.Defaults.LoadOptions,s.LoadOptions[t]);return"function"==typeof e.loadHandler?e.loadHandler(this.viewer,e):new Promise((t,i)=>{if(e.urn){try{window.atob(e.urn.replace("urn:",""))}catch(t){e.urn=btoa(e.urn)}Autodesk.Viewing.Document.load(0==e.urn.indexOf("urn:")?e.urn:"urn:"+e.urn,n=>{const o=n.getRoot().search(Object.assign({type:"geometry"},e.type?{type:e.type}:null,e["view-name"]?{name:e["view-name"]}:null,e.guid?{guid:e.guid}:null))[0];this.viewer.start(),this.version[0]>5?this.viewer.loadDocumentNode(n,o,e.option,e=>t(e),t=>i(t)):e.url=n.getViewablePath(o)})}this.viewer[this.viewer.started?"loadModel":"start"](e.url,e,i=>{(e.loadSuccessCallback||(()=>{}))(),t(i)},t=>{(e.loadFailureCallback||(()=>{}))(),i(t)})})}initViewer(){return new(this.useGUI?Autodesk.Viewing.Private.GuiViewer3D:Autodesk.Viewing.Private.Viewer3D)(this.container,Object.assign({},s.ViewerOptions[this.name],s.Defaults.ViewerOptions))}}window.AutodeskForge={WebComponent:s},window.customElements.define("forge-viewer",class extends HTMLElement{constructor(){super();const e=Object.assign({},o,a((this.querySelector("model-options")||{}).textContent)),m=Array.prototype.map.call(this.querySelectorAll("model")||[],t=>h(t,e)),p=(this.querySelector("css")||{}).textContent;let w=this.getAttribute("version")||r;"1"==w.length&&(w+=".*");const v=this.getAttribute("name")||t(),f="true"===this.getAttribute("delay-load"),b="false"!==this.getAttribute("GUI"),y="true"===this.getAttribute("shadow-mode"),O=!b&&"false"!==this.getAttribute("shadow-mode")||y?this.attachShadow({mode:"open"}):this,A=Object.assign({accessToken:this.getAttribute("access-token")},a((this.querySelector("init-options")||this.querySelector("options")||{}).textContent)),V=a((this.querySelector("viewer-options")||this.querySelector("options")||{}).textContent),j=document.createElement("div");j.id=this.getAttribute("container-id")||t(t=>document.getElementById(t)),j.className=this.getAttribute("class")||"",function({id:t,css:e,height:i,width:n,position:o,left:r,top:s,right:a,bottom:l}){c(`#${t} .adsk-viewing-viewer { ${e||""}; ${i?"height:"+d(i,"%")+"!important;":""}  ${n?"width:"+d(n,"%",100)+"!important;":""} ${o?"position:"+(["fixed","absolute"].includes(o)?o:"relative")+"!important;":""} ${r?"left:"+d(n,"%",100)+"!important;":""} ${s?"top:"+d(s,"%","unset")+"!important;":""} ${a?"right:"+d(a,"%","unset")+"!important;":""} ${l?"bottom:"+d(l,"%","unset")+"!important":""}}`)}({id:j.id,css:this.getAttribute("css"),height:this.getAttribute("height"),width:this.getAttribute("width"),position:this.getAttribute("position"),left:this.getAttribute("left"),top:this.getAttribute("top"),right:this.getAttribute("right"),bottom:this.getAttribute("bottom")}),this.innerHTML="",O.appendChild(j),p&&c(p,y?O:null);const L=Array.prototype.map.call(this.querySelectorAll("dependency")||[],t=>t.getAttribute("src"));var k;s.state.loaded||u("loadDependency",Promise.all([l(i+w,y?O:null),(k=n+w,new Promise((t,e)=>{const i=document.createElement("script");i.type="text/javascript",i.src=k,i.onload=()=>t(i),i.onError=()=>e(i),document.head.appendChild(i)}))]).then(()=>s.state.loaded=!0)),new g({version:w,deps:L,delayLoad:f,initOptions:A,viewerOptions:V,models:m,useGUI:b,container:j,name:v}).init()}})}();
